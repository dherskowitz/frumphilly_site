{% load webpack_static from webpack_loader %}
{% load socialaccount %}

<div x-data="{ showMobileMenu: false }" class="md:hidden" x-cloak>
    <div @click="showMobileMenu = !showMobileMenu" class="mr-4 cursor-pointer" :class="{ 'navbar__icon--open' : showMobileMenu}">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
    </div>
    <div x-show="showMobileMenu" @click.away="showMobileMenu = false" class="fixed h-full overflow-y-auto left-0 top-avoid-header w-full z-50 bg-bgGrey p-4 shadow-md pointer-events-none" :class="{ 'block pointer-events-auto' : showMobileMenu}" x-transition:enter="transition ease-in duration-100" x-transition:enter-start="opacity-0 transform translate-y-4" x-transition:enter-end="opacity-100 transform translate-y-0" x-transition:leave="transition ease-in duration-100" x-transition:leave-start="opacity-100 transform translate-y-0" x-transition:leave-end="opacity-0 transform translate-y-4">
        {% with url_name=request.resolver_match.url_name  %}
        <a class=" mobilelink{% if url_name == 'home' %} active{% endif %}" href="{% url 'home' %}" href="{% url 'home' %}">Home</a>

        <a class="mobilelink{% if url_name == 'events' %} active{% endif %}" href="{% url 'events_all' %}" href="{% url 'events_all' %}">Events</a>

        <div x-data="{ showListingsMenu: false }" x-cloak>
            <button @click="showListingsMenu = !showListingsMenu" class="mobilelink flex w-full py-2 px-4" :class="{ 'bg-gray-800 text-white' : showListingsMenu}">
                <span>Listings</span>
                <svg class="-mr-1 ml-2 h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
            </button>
            <div x-show="showListingsMenu" @click.away="showListingsMenu = false" class="bg-gray-200 mb-4 rounded-md"
            x-transition:enter="transition ease-in duration-100" x-transition:enter-start="opacity-0 transform translate-y-4" x-transition:enter-end="opacity-100 transform translate-y-0" x-transition:leave="transition ease-in duration-100" x-transition:leave-start="opacity-100 transform translate-y-0" x-transition:leave-end="opacity-0 transform translate-y-4">
                {% with current_url=request.resolver_match.kwargs.slug  %}
                {% for cat in nav_categories %}
                <a class="block px-4 py-2 text-sm leading-5 text-gray-700 hover:bg-gray-400 hover:text-gray-900 focus:outline-none focus:bg-gray-400 focus:text-gray-900 {% if current_url == cat.slug %} pointer-events-none bg-gray-400 {% endif %}" href="{% url "listings" cat.slug %}" role="menuitem">{{cat.title}}</a>
                {% endfor %}
                {% endwith %}
            </div>
        </div>

        {% if user.is_authenticated %}
        <hr class="border-blue-900">
        <div class="mx-4 my-4 flex items-center">
            {% if user.avatar %}
            <img class="h-10 w-10 rounded-full object-cover" src="{{ user.avatar.url }}" alt="" width="10" height="10">
            {% elif user.socialaccount_set.all.0.get_avatar_url %}
            <img class="h-10 w-10 rounded-full object-cover" src="{{ user.socialaccount_set.all.0.get_avatar_url }}" alt="" width="10" height="10">
            {% else %}
            <img class="h-10 w-10 rounded-full object-cover" src="{% webpack_static 'img/images/blank_avatar.jpg' %}" alt="" width="10" height="10">
            {% endif %}
            <span class="ml-4">
                <p>{{ user.first_name }} {{ user.last_name }}</p>
                <p>{{ user.email }}</p>
            </span>
        </div>

        <a class="mobilelink{% if url_name == 'user_account' %} active{% endif %}" href="{% url 'user_account' %}" href="{% url 'user_account' %}">My Account</a>
        <a class="mobilelink{% if url_name == 'listings_select' %} active{% endif %}" href="{% url 'listings_select' %}"" href=" {% url 'listings_select' %}">Create Listing</a>
        <a class="mobilelink{% if url_name == 'events_create' %} active{% endif %}" href="{% url 'events_create' %}"" href=" {% url 'events_create' %}">Create Event</a>

        <form class="bg-transparent mobilelink" action="{% url 'account_logout' %}" method="POST">
            {% csrf_token %}
            <input class="bg-transparent" type="submit" value="Log Out">
        </form>

        {% else %}

        <a class="mobilelink{% if url_name == 'account_login' %} active{% endif %}" href="{% url 'account_login' %}" href="{% url 'account_login' %}">Sign In</a>

        <a class="btn btn-md block text-center md:text-left md:flex items-center justify-center mt-8 md:mt-0 md:ml-4{% if url_name == 'account_signup' %} active{% endif %}" href="{% url 'account_signup' %}">Create Account</a>

        {% endif %}

        {% endwith %}
    </div>
</div>
