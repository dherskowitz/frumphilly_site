{% extends 'dashboard.html' %}
{% load webpack_static from webpack_loader %}

{% block main %}

<section class="my-10">
    <div class="mb-4">
        <h2 class="text-4xl text-white text-shadow">Review Your Order</h2>
    </div>
    {{stripe}}
    <div class="p-4 bg-white rounded-md shadow-md">
        <div class="flex justify-between">
            <div class="flex flex-col justify-between w-1/3 text-gray-700">
                <div class="flex justify-between border-b">
                    <span class="font-semibold">Title:</span>
                    <span>{{ad.title}}</span>
                </div>
                <div class="flex justify-between mt-2 border-b">
                    <span class="font-semibold">Ad Type:</span>
                    <span>{{ad.type|title}} Ad</span>
                </div>
    
                {% if ad.contract_length == 7 %}
                    <div class="flex justify-between mt-2 border-b">:
                        <span class="font-semibold">Length of Term:</span>
                        <span>One Week</span>
                    </div>
                    <div class="flex justify-between mt-2 border-b">
                        <span class="font-semibold">Price:</span>
                        <span>$10.00</span>
                    </div>
                {% elif ad.contract_length == 14 %}
                    <div class="flex justify-between mt-2 border-b">
                        <span class="font-semibold">Length of Term:</span>
                        <span>Two Weeks</span>
                    </div>
                    <div class="flex justify-between mt-2 border-b">
                        <span class="font-semibold">Price:</span>
                        <span>$18.00</span>
                    </div>
                {% elif ad.contract_length == 30 %}
                    <div class="flex justify-between mt-2 border-b">
                        <span class="font-semibold">Length of Term:</span>
                        <span>One Month</span>
                    </div>
                    <div class="flex justify-between mt-2 border-b">
                        <span class="font-semibold">Price:</span>
                        <span>$30.00</span>
                    </div>
                {% elif ad.contract_length == 60 %}
                    <div class="flex justify-between mt-2 border-b">
                        <span class="font-semibold">Length of Term:</span>
                        <span>Two Months</span>
                    </div>
                    <div class="flex justify-between mt-2 border-b">
                        <span class="font-semibold">Price:</span>
                        <span>$50.00</span>
                    </div>
                {% elif ad.contract_length == 90 %}
                    <div class="flex justify-between mt-2 border-b">
                        <span class="font-semibold">Length of Term:</span>
                        <span>Three Months</span>
                    </div>
                    <div class="flex justify-between mt-2 border-b">
                        <span class="font-semibold">Price:</span>
                        <span>$90.00</span>
                    </div>       
                {% endif %}
            </div>
            <div>
                <span class="font-semibold">Ad Image</span>
                {% if ad.type == "sidebar" %}
                <img width="300" src="{{ad.image.url}}" alt="">
                {% endif %}
            </div>
        </div>
    </div>
    <div class="flex flex-row-reverse mt-6">
        <a class="text-2xl font-semibold btn btn-md" id="submitPayment" href="#">Proceed to Payment</a>
    </div>
</section>

{% endblock main %}

{% block template_js %}
<script src="https://js.stripe.com/v3/"></script>
<script>
    let stripe;
    stripe = Stripe("{{stripe.public_key}}");
    
    document.querySelector("#submitPayment").addEventListener("click", (e) => {
        e.preventDefault();
        // Get Checkout Session ID
        fetch("/payments/create-ad-checkout-session/?ad={{ad.redirect_uuid}}")
            .then(result => result.json())
            .then(data => stripe.redirectToCheckout({sessionId: data.sessionId}))
            .then(res => console.log(res))
            .catch(err=> console.log(err));
    });
</script>
{% endblock template_js %}
