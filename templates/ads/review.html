{% extends 'dashboard.html' %}
{% load webpack_static from webpack_loader %}

{% block main %}

<section class="my-10">

    <div class="mb-4">
        <h2 class="text-4xl text-white text-shadow">Review Your Order</h2>
    </div>

    <div class="bg-white rounded-md shadow-md">
        <div class="flex items-center justify-between p-8 text-gray-600 border-b-2">
            <div class="text-2xl font-semibold">{{ad.title}}</div>
            <a class="text-blue-600 underline" href="{% url 'edit_ad' uuid=ad.redirect_uuid %}">Edit Ad</a>
        </div>

        <div class="flex px-8 py-4 bg-gray-100">
            <div class="w-1/3 text-sm font-semibold text-gray-600">Ad Type</div>
            <div class="w-2/3">{{ad.type|title}} Ad</div>
        </div>

        <div class="flex px-8 py-4">
            <div class="w-1/3 text-sm font-semibold text-gray-600">Length of Term</div>
            <div class="w-2/3">{{price_info.term}}</div>
        </div>

        <div class="flex px-8 py-4 bg-gray-100">
            <div class="w-1/3 text-sm font-semibold text-gray-600">Length of Term</div>
            <div class="w-2/3">${{price_info.price}}.00</div>
        </div>

        <div class="flex px-8 py-4">
            <div class="w-1/3 text-sm font-semibold text-gray-600">Link Ad To</div>
            <div class="w-2/3">{{ad.redirect_to}}</div>
        </div>

        <div class="flex px-8 py-4 bg-gray-100">
            <div class="w-1/3 text-sm font-semibold text-gray-600">Ad Image</div>
            <div class="w-2/3"><img style="max-height: 250px;" src="{{ad.image.url}}" alt=""></div>
        </div>

    </div>

    <div class="flex flex-row-reverse mt-6">
        <a class="text-2xl font-semibold btn btn-md" id="submitPayment" href="#">Proceed to Payment</a>
    </div>

</section>

{% endblock main %}

{% block template_js %}
<script src="https://js.stripe.com/v3/"></script>
<script>
    let stripe;
    stripe = Stripe("{{stripe.public_key}}");
    
    document.querySelector("#submitPayment").addEventListener("click", (e) => {
        e.preventDefault();
        // Get Checkout Session ID
        fetch("/payments/create-ad-checkout-session/?ad={{ad.redirect_uuid}}")
            .then(result => result.json())
            .then(data => stripe.redirectToCheckout({sessionId: data.sessionId}))
            .then(res => console.log(res))
            .catch(err=> console.log(err));
    });
</script>
{% endblock template_js %}
